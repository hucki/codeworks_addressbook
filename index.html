<!DOCTYPE html>
<html>
<head>
  <link href="./css/stylesheet.css" type="text/css" rel="stylesheet" />
  <script src="./js/jquery-3.4.1.js" type="text/javascript"></script>
  <script src="./js/script.js" type="text/javascript" charset="utf-8"></script>
  <meta name="theme-color" content="#62757f">
</head>
<body>
  <header>
    <div class="header">
      <h1>Address Book Coding Challenge</h1>
    </div>
  </header>
  <main>
    <div class="search">
      <p>Search Contacts: <input type="text" name="searchfield" id="searchfield" value="">
      </p>
      <!-- Searchbar -->

    </div>
    <div class="contacts">
      <h2>Contact List</h2>
      <div id="contacts_table">
        You don't have any contacts :*-(
      </div>
      <!-- Table with adresses -->
    </div>
    <!-- <form id="newAddressForm">-->
    <div id="confirmedMessage" class="confirmation" style="display: none;"></div>
    <table id="actualContactList">
      <thead>
        <tr>
          <td><input id="checkAll" type="checkbox" value="0" name="checkAll"></td>
          <td>First Name</td>
          <td>Surname</td>
          <td>Phone Number</td>
          <td>Address</td>
        </tr>
      </thead>
      <tbody>

      </tbody>
      <tfoot>
          <td></td>
          <td><input id="newFirstName" type="text" name="First Name" label="First Name" value=""></td>
          <td><input id="newSurname" type="text" name="Surname" value=""></td>
          <td><input id="newPhone" type="text" name="Phone" value=""></td>
          <td><input id="newAddress" type="text" name="Address" value=""></td>
          <td><button id="addContactButton">Add</button></td>
      </tfoot>
    </table>
    <div class="controls">
      <button id="resetContactButton">Reset Contacts</button>
      <button id="deleteContactButton">Delete selected Contact(s)</button>
    </div>
  </main>
  <footer class="footer"> (c) 2020 by Stefan Huckschlag </footer>
  <script type="text/javascript">

    // ::: ToDo :::
    // add delete undo
    // hide searchbar, when 0 contacts
    // edit single contacts
    // use #confirmedMessage for all messages
    // put all functions in script.js

    // ::: Cleanup :::
    // order themed functions
    // order css
    // remove unused functions/vars...
    // merge dev back to master


    $('#checkAll').change(function(event) {
      $(':checkbox').each(function(){
        $(this).prop('checked',$('#checkAll').prop('checked'));
      })
    })

    $(':checkbox').change(function(event) {
      if($(this)!=$('#checkAll') && $(this).prop('checked')===false) {
        $('#checkAll').prop('checked',false);
      }
    })

    $('#searchfield').keyup(liveSearch);


    $('#resetContactButton').on('click', resetContacts);
    $('#deleteContactButton').on('click', function(event) {
      //console.log(addressBook);
      let contactsToDelete = [];
      $(':checkbox').each(function(){
        ($(this).prop('checked')===true) ? contactsToDelete.push($(this).attr('id').replace('check_','')):null;
        //console.log(contactsToDelete);
        //addressBookDeleted.push(addressBook.splice(1,1));
        //$(this).attr('id').replace('check_','')
      })
      let deleteCounter = 0;
      contactsToDelete.forEach((item, i) => {
        addressBookDeletedArray.push(addressBook.splice(item-deleteCounter,1));
        deleteCounter++;
      });
      addressBookDeletedArray.forEach((item, i) => {
        addressBookDeleted.push(item[0]);
      });
      addressBook.forEach((item, i) => {
        console.log(item);
      });
      addressBookDeleted.forEach((item, i) => {
        console.log('deleted' + item);
      });
      $('#confirmedMessage').text(`${(deleteCounter>0?deleteCounter:'No')} contact${(deleteCounter>1?'s':'')} deleted.`).slideDown();
      setTimeout(function () {
        $('#confirmedMessage').slideUp();
      }, 2000);;
      showContactList();



      //deleteContacts();
    });
    // add contact handler
    $('input[type=text]').not('#searchfield').keyup(addContact);
    $('#addContactButton').on('click', addContact);

    //resetContacts();
    showContactList();
  </script>
</body>
</html>
